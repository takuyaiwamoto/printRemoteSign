<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>シンプルお絵かき (A4縦)</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="toolbar">
      <div class="left">
        <strong>シンプルお絵かき</strong>
        <span class="muted">— A4縦キャンバス</span>
        <span class="muted" id="sender-version"></span>
        <span class="muted" id="author-badge"></span>
      </div>
      
    </header>

    <main class="stage">
      <!--
        A4 縦の比率は 210 : 297 (およそ 0.707 : 1)。
        実際の描画解像度はデバイスピクセルに合わせて JS 側で設定します。
      -->
      <div id="canvas-wrap" class="canvas-wrap">
        <canvas id="paint"></canvas>
        <canvas id="others" style="position:absolute; inset:0; pointer-events:none;"></canvas>
      </div>

      <!-- 右側ツール群（縦三列の太さ / 隣に色ボタン） -->
      <aside class="side-tools" aria-label="ツール">
        <div class="group sizes" aria-label="ペン太さ">
          <button class="size-btn active" data-size="thin" title="細い" aria-pressed="true">
            <span class="stroke stroke-thin"></span>
          </button>
          <button class="size-btn" data-size="normal" title="普通" aria-pressed="false">
            <span class="stroke stroke-normal"></span>
          </button>
          <button class="size-btn" data-size="thick" title="太い" aria-pressed="false">
            <span class="stroke stroke-thick"></span>
          </button>
        </div>
        <div class="group colors" aria-label="色">
          <button class="color-btn active" data-color="#000000" title="黒" style="--swatch:#000000" aria-pressed="true"></button>
          <button class="color-btn" data-color="#e11d48" title="赤" style="--swatch:#e11d48" aria-pressed="false"></button>
          <button class="color-btn" data-color="#2563eb" title="青" style="--swatch:#2563eb" aria-pressed="false"></button>
          <button class="color-btn" data-color="#16a34a" title="緑" style="--swatch:#16a34a" aria-pressed="false"></button>
          <button class="color-btn" data-color="#ec4899" title="ピンク" style="--swatch:#ec4899" aria-pressed="false"></button>
        </div>
        <div class="group actions" aria-label="操作">
          <button id="btn-clear-all" class="action-btn" title="全消し" aria-pressed="false">全消し</button>
          <button id="btn-eraser" class="action-btn" title="消しゴム" aria-pressed="false">消しゴム</button>
          <button id="btn-send" class="action-btn" title="送る" aria-pressed="false">送る</button>
          <button id="btn-overlay-start" class="action-btn" title="開始" aria-pressed="false">開始</button>
        </div>
      </aside>

      <p class="hint">クリック＆ドラッグ（指ならスワイプ）で線が描けます。</p>
    </main>

    <!-- 送信側の接続先設定（編集可） -->
    <script src="sender-config.js"></script>
    <!-- file:// で開いた場合は ESModules がCORSにより読めないため、旧 main.js を動的ロード -->
    <script>
      (function(){
        var isFile = location.protocol === 'file:';
        var sdebug = (new URLSearchParams(location.search)).get('sdebug') === '1';
        if (isFile) {
          // file:// では ESModules が読み込めないため、UMD版の共有ライブラリを順に読み込んでから main.js を起動
          var files = [
            'src/sender/shared/constants.js',
            'src/sender/shared/pointer.js',
            'src/sender/shared/layout.js',
            'src/sender/shared/otherStrokes.js',
            'main.js'
          ];
          (function load(i){
            if (i >= files.length) return;
            var tag = document.createElement('script');
            tag.src = files[i];
            tag.onload = function(){ if (sdebug) try { console.log('[loader] loaded', files[i]); } catch(_) {} load(i+1); };
            tag.onerror = function(){ if (sdebug) try { console.warn('[loader] failed', files[i]); } catch(_) {} load(i+1); };
            document.head.appendChild(tag);
          })(0);
        } else {
          // On GitHub Pages, also load UMD shared libs so window.SenderShared is available
          var libs = [
            'src/sender/shared/constants.js',
            'src/sender/shared/pointer.js',
            'src/sender/shared/layout.js',
            'src/sender/shared/otherStrokes.js'
          ];
          var i = 0;
          function loadLibs(cb){
            if (i >= libs.length) return cb();
            var tag = document.createElement('script');
            tag.src = libs[i] + '?v=' + (document.querySelector('meta[name=build-id]')?.content || Date.now());
            tag.onload = function(){ i++; loadLibs(cb); };
            tag.onerror = function(){ i++; loadLibs(cb); };
            document.head.appendChild(tag);
          }
          loadLibs(function(){
            var m = document.createElement('script');
            m.type = 'module';
            // Cache-busting to bypass CDN stale files on Pages
            m.src = 'src/sender/index.js?v=' + (document.querySelector('meta[name=build-id]')?.content || Date.now());
            document.head.appendChild(m);
          });
        }
      })();
    </script>
  </body>
  </html>
